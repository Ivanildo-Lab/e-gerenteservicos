<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>DRE - {{ empresa.nome }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body { 
                -webkit-print-color-adjust: exact; 
                font-size: 8pt; /* Fonte bem pequena padrão extrato */
            }
            .no-print { display: none !important; }
            .bg-gray-100 { background-color: #fff !important; }
            /* Margens mínimas para aproveitar a folha */
            @page { margin: 0.5cm; }
        }
        
        body { font-family: 'Inter', sans-serif; font-size: 11px; }
        
        .dotted-line { border-bottom: 1px dotted #ccc; }
    </style>
</head>
<body class="bg-gray-100 p-4 print:p-0 text-gray-900 font-sans">

    <!-- Container sem sombra na impressão -->
    <div class="max-w-5xl mx-auto bg-white shadow-lg print:shadow-none print:w-full min-h-screen">
        
        <!-- 1. CABEÇALHO SUPER COMPACTO -->
        <div class="px-4 py-2 border-b border-gray-300 flex justify-between items-center">
            <div class="flex items-center gap-2">
                {% if empresa.logo %}
                    <img src="{{ empresa.logo.url }}" class="h-8 w-auto object-contain">
                {% endif %}
                <div>
                    <h1 class="text-sm font-bold uppercase tracking-wide leading-none">{{ empresa.nome }}</h1>
                    <p class="text-[9px] text-gray-500">CNPJ: {{ empresa.cnpj }}</p>
                </div>
            </div>
            <div class="text-right">
                <h2 class="text-xs font-bold text-gray-700 uppercase">DRE - Analítico</h2>
                <p class="text-[9px] text-gray-500">Comp: {{ data_inicio|date:"d/m/y" }} a {{ data_fim|date:"d/m/y" }}</p>
            </div>
        </div>

        <!-- FILTRO (Tela) -->
        <div class="no-print p-3 bg-blue-50 border-b flex gap-2 items-center justify-between text-xs">
            <form method="GET" class="flex gap-2 items-center">
                <span>De:</span>
                <input type="date" name="data_inicio" value="{{ data_inicio|date:'Y-m-d' }}" class="border p-1 rounded">
                <span>Até:</span>
                <input type="date" name="data_fim" value="{{ data_fim|date:'Y-m-d' }}" class="border p-1 rounded">
                <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Atualizar</button>
            </form>
            <div class="space-x-2">
                <a href="{% url 'financeiro:relatorio_dre_sintetico' %}?data_inicio={{ data_inicio|date:'Y-m-d' }}&data_fim={{ data_fim|date:'Y-m-d' }}" class="text-blue-700 hover:underline">Ir para Sintético</a>
                <button onclick="window.print()" class="bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800"><i class="fa fa-print"></i> Imprimir</button>
            </div>
        </div>

        <div class="p-4 space-y-4">

            <!-- 1. RECEITAS -->
            <div>
                <div class="flex justify-between items-end border-b border-gray-400 mb-1 pb-0.5">
                    <h3 class="font-bold text-xs uppercase">1. Receitas</h3>
                </div>
                <table class="w-full text-[9px] print:text-[8pt]">
                    {% for item in receitas %}
                    <tr>
                        <td class="w-16 font-mono text-gray-500">{{ item.plano_de_contas__codigo|default:"" }}</td>
                        <td class="dotted-line py-0.5">{{ item.plano_de_contas__nome }}</td>
                        <td class="text-right w-24 font-medium py-0.5">{{ item.total|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-gray-50 font-bold">
                        <td colspan="2" class="text-right py-1 pr-2">Total Receitas:</td>
                        <td class="text-right py-1 border-t border-gray-300">{{ total_receitas|floatformat:2 }}</td>
                    </tr>
                </table>
            </div>

            <!-- 2. DESPESAS -->
            <div>
                <div class="flex justify-between items-end border-b border-gray-400 mb-1 pb-0.5">
                    <h3 class="font-bold text-xs uppercase">2. Despesas</h3>
                </div>
                <table class="w-full text-[9px] print:text-[8pt]">
                    {% for item in despesas %}
                    <tr>
                        <td class="w-16 font-mono text-gray-500">{{ item.plano_de_contas__codigo|default:"" }}</td>
                        <td class="dotted-line py-0.5">{{ item.plano_de_contas__nome }}</td>
                        <td class="text-right w-24 font-medium text-red-600 py-0.5">({{ item.total|floatformat:2 }})</td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-gray-50 font-bold">
                        <td colspan="2" class="text-right py-1 pr-2">Total Despesas:</td>
                        <td class="text-right py-1 text-red-600 border-t border-gray-300">{{ total_despesas|floatformat:2 }}</td>
                    </tr>
                </table>
            </div>

            <!-- 3. RESULTADO -->
            <div class="mt-4 border-t-2 border-gray-800 pt-2">
                <div class="flex justify-between items-center px-2 py-1 bg-gray-100 rounded">
                    <span class="font-bold text-xs uppercase">Resultado Líquido</span>
                    <span class="font-bold text-sm {% if resultado >= 0 %}text-blue-700{% else %}text-red-700{% endif %}">
                        R$ {{ resultado|floatformat:2 }}
                    </span>
                </div>
            </div>

        </div>
        
        <div class="text-center text-[8px] text-gray-400 mt-4">e-Financeiro SaaS • Uso Interno</div>
    </div>
</body>
</html>